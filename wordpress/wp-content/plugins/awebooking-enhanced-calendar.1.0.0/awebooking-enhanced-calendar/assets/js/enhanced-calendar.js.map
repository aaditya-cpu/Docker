{"version":3,"file":"enhanced-calendar.js","sources":["assets/babel/enhanced-calendar.js"],"sourcesContent":["/**\n * AweBooking Availability Calendar.\n *\n * @type {ACalendar}\n */\nconst AvailabilityCalendar = (function($) {\n  const DEFAULTS = {\n    show_month: 1,\n  }\n\n  function getDateFromElement (element) {\n    element = element instanceof jQuery ? element[0] : element\n    return awebooking.utils.dates.format(element.dateObj, 'Y-m-d')\n  }\n\n  class ACalendar {\n    constructor (element, room, options) {\n      this.room    = room\n      this.element = element\n      this.options = $.extend({}, DEFAULTS, options)\n      this.availability = void 0\n      this._xhrRequest  = void 0\n    }\n\n    init() {\n      flatpickr(this.element, {\n        mode: 'single',\n        inline: true,\n        static: true,\n        showMonths: this.options.show_months || 1,\n        minDate: 'today',\n        maxDate: this.getMaxDate(),\n        onReady: this._getAvailability.bind(this),\n        onMonthChange: this._getAvailability.bind(this),\n        onDayCreate: this._onFlatpickrDayCreate.bind(this),\n      })\n    }\n\n    getMaxDate() {\n      let d = new Date\n      d.setMonth(d.getMonth() + 6)\n      return d\n    }\n\n    _getAvailability(_, __, fp) {\n      if (this._xhrRequest) {\n        this._xhrRequest.abort()\n      }\n\n      // Create xhr request.\n      this._xhrRequest = ACalendar.fetchAvailability(this.room, fp)\n\n      // Fetch the availability\n      this._xhrRequest.then((data) => {\n        this._xhrRequest  = void 0\n        this.availability = data;\n        fp.redraw()\n      })\n    }\n\n    _onFlatpickrDayCreate(_, __, fp, dayElem) {\n      if (!this.availability || dayElem.classList.contains('disabled')) {\n        return\n      }\n\n      const dateIndex = getDateFromElement(dayElem)\n      if (!this.availability.hasOwnProperty(dateIndex)) {\n        return\n      }\n\n      const rooms = this.availability[dateIndex];\n      $(dayElem).addClass(rooms === 0 ? 'unavailable disabled' : 'available')\n    }\n  }\n\n  /**\n   * Fetch the availability calendar.\n   *\n   * @param calendar\n   * @param fp\n   * @returns {JQuery.jqXHR}\n   */\n  ACalendar.fetchAvailability = function (calendar, fp) {\n    let args = {}\n\n    if (fp.config.showMonths === 1) {\n      args = {month: fp.currentMonth + 1, year: fp.currentYear}\n    } else {\n      const $days = $(fp.daysContainer).find('.flatpickr-day')\n      args.start_date = getDateFromElement($days.first())\n      args.end_date = getDateFromElement($days.last())\n    }\n\n    return $.ajax({\n      url: awebooking.route(`/calendar/availability/${calendar}`),\n      data: args,\n      method: 'GET',\n      dataType: 'json',\n    })\n  }\n\n  // Fire on document loaded.\n  $(function () {\n    $('[data-init=\"availability-calendar\"]').each(function (index, element) {\n      const room = $(element).data('room')\n      const options = $(element).data('settings')\n\n      const calendar = new ACalendar(element, room, options)\n      calendar.init()\n\n      $(element).data('a-calendar', calendar)\n    })\n  })\n\n  return ACalendar\n})(jQuery)\n\n// Share the object into the awebooking instances.\nawebooking.instances.AvailabilityCalendar = AvailabilityCalendar\n"],"names":["AvailabilityCalendar","$","DEFAULTS","show_month","getDateFromElement","element","jQuery","awebooking","utils","dates","format","dateObj","ACalendar","room","options","extend","availability","_xhrRequest","flatpickr","mode","inline","static","showMonths","show_months","minDate","maxDate","getMaxDate","onReady","_getAvailability","bind","onMonthChange","onDayCreate","_onFlatpickrDayCreate","d","Date","setMonth","getMonth","_","__","fp","abort","fetchAvailability","then","data","redraw","dayElem","classList","contains","dateIndex","hasOwnProperty","rooms","addClass","calendar","args","config","month","currentMonth","year","currentYear","$days","daysContainer","find","start_date","first","end_date","last","ajax","url","route","method","dataType","each","index","init","instances"],"mappings":"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"}