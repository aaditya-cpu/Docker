!function r(a,u,p){function c(n,e){if(!u[n]){if(!a[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(s)return s(n,!0);var i=new Error("Cannot find module '"+n+"'");throw i.code="MODULE_NOT_FOUND",i}var o=u[n]={exports:{}};a[n][0].call(o.exports,function(e){return c(a[n][1][e]||e)},o,o.exports,r,a,u,p)}return u[n].exports}for(var s="function"==typeof require&&require,e=0;e<p.length;e++)c(p[e]);return c}({1:[function(e,n,t){"use strict";var o,i,r=function(){function i(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,n,t){return n&&i(e.prototype,n),t&&i(e,t),e}}();o=jQuery,window.awebooking,i=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.queue=[],this.popup=swal.mixin({html:"<code></code>",width:"650px",padding:"1rem",customClass:"icalendar-alertbox",allowEscapeKey:!1,allowOutsideClick:!1})}return r(e,[{key:"run",value:function(e){var n=this;this.popup.isVisible()?this._createEventSource(e):this.popup({title:"Syncing",onOpen:function(){n._createEventSource(e)}})}},{key:"_writeLineUpdate",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"debug";if(this.popup.isVisible()){n=n.toLowerCase();var t=o(this.popup.getContent()).find("code");0<t.length&&(t.append('<p class="line-'+n+'">'+e+"</p>"),t.scrollTop(t[0].scrollHeight))}}},{key:"_createEventSource",value:function(e){var t=this,n=new EventSource(awebooking.route("/ical/"+e+"/pull")),i=function(){n.close(),t.popup.isVisible()&&t.popup.hideLoading()};this.popup.isVisible()&&this.popup.showLoading(),n.onerror=function(){i(),t.popup.isVisible()&&(o(t.popup.getContent()).find("code").hide(),t.popup.showValidationError("Connection error"))},n.onmessage=function(e){switch(JSON.parse(e.data).action){case"update":break;case"complete":i()}},n.addEventListener("log",function(e){var n=JSON.parse(e.data);t._writeLineUpdate(n.message,n.level)})}}]),e}(),o(function(){var n=new i;o(".js-icalendar-sync").on("click",function(e){e.preventDefault(),n.run(o(this).data("room"))}),o(".js-icalendar-export").on("click",function(e){e.preventDefault(),swal({title:"Export iCalendar",input:"text",inputValue:o(this).data("link")})})})},{}]},{},[1]);